namespace eval vfbdb::vhdl-wb3::config-0 {
	variable ctx [hbs::vfbdb::_ctxName [namespace current]]
	variable hdl [hbs::vfbdb::_hdlName [namespace current]]

	proc _tb {lang swGwFifo gwSwFifo logDir} {
		variable ctx
		variable hdl

		hbs::SetTool "ghdl"
		hbs::SetTop "tb_cosim"

		hbs::AddDep vfbdb::gen \
			$hdl -path autogen/$ctx/tb-$lang \
			$lang -path autogen/$ctx/tb-$lang \
			[hbs::CoreDir]/../bus.fbd

		hbs::AddDep $hdl\::cosim::src
		hbs::AddFile *.vhd

		hbs::SetGeneric G_SW_GW_FIFO_PATH $swGwFifo
		hbs::SetGeneric G_GW_SW_FIFO_PATH $gwSwFifo

		if {[file exist $logDir] eq 0} {
			file mkdir $logDir
		}
	}

	proc tb-python {} {
		variable ctx

		set lang "python"
		set hdl [hbs::vfbdb::_hdlName [namespace current]]

		set swGwFifo "/tmp/go-vfbdb/$ctx/$lang-to-$hdl"
		set gwSwFifo "/tmp/go-vfbdb/$ctx/$hdl-to-$lang"
		set logDir /tmp/go-vfbdb/$ctx/tb-$lang

		_tb $lang $swGwFifo $gwSwFifo $logDir

		set ::env(PYTHONPATH) $::env(PYTHONPATH):[pwd]/autogen/$ctx/tb-$lang
		hbs::Exec python3 ../$lang/tb.py $swGwFifo $gwSwFifo > $logDir/$hdl.log &

		hbs::Run
	}

	hbs::Register
}
